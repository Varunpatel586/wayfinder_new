<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${place.name} + ' - WayFinder'">Place Details</title>
    <link rel="stylesheet" th:href="@{/css/place-details.css}">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="place-details-container">
    <!-- Hero Image -->
    <div class="hero-image" th:style="'background-image: url(' + ${place.imageUrl} + ');'">
        <div class="hero-overlay">
            <h1 th:text="${place.name}">Place Name</h1>
            <p class="location" th:if="${place.country}">
                üìç <span th:text="${place.country}">Country</span>
            </p>
        </div>
    </div>

    <!-- Content Section -->
    <div class="content-wrapper">
        <!-- Left Column: Details -->
        <div class="details-column">
            <div class="info-card">
                <h2>About This Destination</h2>
                <p th:text="${place.description}">Description</p>

                <div class="stats" th:if="${place.averageRating}">
                    <div class="stat-item">
                        <span class="stat-label">Rating</span>
                        <span class="stat-value">‚≠ê <span th:text="${place.averageRating}">4.5</span></span>
                    </div>
                    <div class="stat-item" th:if="${place.reviewCount}">
                        <span class="stat-label">Reviews</span>
                        <span class="stat-value" th:text="${place.reviewCount}">1234</span>
                    </div>
                </div>
            </div>

            <!-- AI Route Generator - Available to all users -->
            <div class="route-generator-card">
                <h2>ü§ñ AI Travel Planner</h2>
                <p>Generate a personalized itinerary using AI</p>

                <div class="form-group">
                    <label for="trip-days">Number of Days:</label>
                    <select id="trip-days">
                        <option value="3">3 Days</option>
                        <option value="5" selected>5 Days</option>
                        <option value="7">7 Days</option>
                        <option value="10">10 Days</option>
                    </select>
                </div>

                <button id="generate-route-btn" class="btn btn-primary">
                    Generate Itinerary
                </button>

                <div id="route-loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Generating your personalized itinerary...</p>
                </div>

                <div id="route-result" class="route-result" style="display: none;">
                    <h3>Your Personalized Itinerary</h3>
                    <div id="itinerary-content"></div>

                    <!-- Add save prompt for non-logged in users -->
                    <div th:unless="${isLoggedIn}" class="save-prompt">
                        <p>Want to save this itinerary?</p>
                        <a th:href="@{/login(redirect='/place/' + ${place.id})}" class="btn btn-outline">
                            Login to Save
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Add to Trip or Login Prompt -->
        <div class="sidebar-column">
            <!-- Show Add Trip Form for Logged In Users -->
            <div th:if="${isLoggedIn}" class="add-trip-card">
                <h3>Plan Your Trip</h3>

                <form id="add-trip-form">
                    <input type="hidden" id="place-id" th:value="${place.id}">

                    <div class="form-group">
                        <label for="start-date">Start Date:</label>
                        <input type="date" id="start-date" required>
                    </div>

                    <div class="form-group">
                        <label for="end-date">End Date:</label>
                        <input type="date" id="end-date" required>
                    </div>

                    <div class="form-group">
                        <label for="trip-notes">Notes (Optional):</label>
                        <textarea id="trip-notes" rows="4" placeholder="Special requests, preferences, etc."></textarea>
                    </div>

                    <button type="submit" class="btn btn-success">
                        ‚ûï Add to My Trips
                    </button>
                </form>

                <div id="trip-message" class="message" style="display: none;"></div>
            </div>

            <!-- Show Login Prompt for Non-Logged In Users -->
            <div th:unless="${isLoggedIn}" class="login-prompt-card">
                <h3>Save Your Trip</h3>
                <div class="login-benefits">
                    <p>Login to unlock:</p>
                    <ul>
                        <li>‚úì Save trips to your account</li>
                        <li>‚úì Access your travel history</li>
                        <li>‚úì Get personalized recommendations</li>
                        <li>‚úì Manage your itineraries</li>
                    </ul>
                </div>
                <a th:href="@{/login(redirect='/place/' + ${place.id})}" class="btn btn-primary btn-block">
                    Login to Plan Trip
                </a>
                <p class="signup-text">
                    New to WayFinder?
                    <a th:href="@{/SignUp}" class="signup-link">Create an account</a>
                </p>
            </div>

            <!-- Quick Info - Always Visible -->
            <div class="quick-info-card">
                <h3>Quick Info</h3>
                <ul>
                    <li><strong>Address:</strong> <span th:text="${place.address}">Address</span></li>
                    <li th:if="${place.category}">
                        <strong>Category:</strong>
                        <span th:text="${place.category}">Category</span>
                    </li>
                    <li th:if="${place.latitude} and ${place.longitude}">
                        <strong>Coordinates:</strong>
                        <span th:text="${place.latitude} + ', ' + ${place.longitude}">Coordinates</span>
                    </li>
                </ul>

                <a th:if="${place.latitude} and ${place.longitude}"
                   th:href="'https://www.google.com/maps?q=' + ${place.latitude} + ',' + ${place.longitude}"
                   target="_blank"
                   class="btn btn-outline">
                    üìç View on Map
                </a>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const placeId = /*[[${place.id}]]*/ 1;
    const placeName = /*[[${place.name}]]*/ 'Place';
    const isLoggedIn = /*[[${isLoggedIn}]]*/ false;
</script>
<script th:src="@{/js/place-details.js}"></script>
</body>
</html>